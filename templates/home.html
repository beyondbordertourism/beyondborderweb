{% extends "base.html" %}

{% block title %}Here. - Your Next Destination Awaits{% endblock %}

{% block content %}
<div class="hero-klook">
    <div class="hero-klook-left">
        <div class="city-carousel">
            <!-- Countries will be loaded dynamically -->
        </div>
    </div>
    <div class="hero-klook-right">
        <div class="search-and-filter-klook">
            <form action="/search" method="GET" class="search-box-klook" autocomplete="off">
                <i class="fas fa-search"></i>
                <input type="text" name="q" id="search-input" placeholder="Search for a country...">
                <button type="submit" class="search-button-klook">Search</button>
            </form>
            <div id="search-results-klook" class="search-results-klook"></div>
            <div class="filter-buttons-klook">
                <button><i class="fas fa-file-alt"></i> Visa Application</button>
                <button><i class="fas fa-check-circle"></i> Document Check</button>
                <button><i class="fas fa-globe-americas"></i> E-Visa Services</button>
            </div>
        </div>
    </div>
</div>

<!-- About Us Section -->
<section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-2 gap-16 items-center">
        <div>
            <p class="eyebrow-text">We are an international travel agency</p>
            <h2 class="main-headline text-2xl md:text-3xl">
                By bringing together trusted partners and industry expertise, we <span class="highlight-text">simplify the process </span> of international travel so you can focus on the journey, not the paperwork. 
            </h2>
            <a href="#" class="read-more-btn">Read more</a>
        </div>
        <div>
            <img src="https://images.unsplash.com/photo-1519666336592-e225a99dcd2f?q=80&w=988&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Airplane wing view" class="rounded-3xl shadow-lg w-full max-w-xs mx-auto">
        </div>
    </div>
</section>



<!-- FAQ Section -->
<section id="faq" class="py-16 bg-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 sm:text-4xl">Frequently Asked Questions</h2>
            <p class="mt-4 text-lg text-gray-600">Find quick answers to common questions about our visa services.</p>
        </div>
        
        <div class="space-y-4">
            <!-- FAQ Item 1 -->
            <div class="faq-item bg-gray-50 rounded-lg shadow-sm">
                <button class="faq-question w-full text-left flex justify-between items-center p-6">
                    <span class="text-lg font-semibold text-gray-800">What documents do I need for a tourist visa?</span>
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                </button>
                <div class="faq-answer p-6 pt-0">
                    <p class="text-gray-600">Required documents typically include a valid passport, application form, recent photographs, flight itinerary, hotel reservations, and proof of financial means. However, requirements vary by country, so please check the specific country's page for exact details.</p>
                </div>
            </div>
            
            <!-- FAQ Item 2 -->
            <div class="faq-item bg-gray-50 rounded-lg shadow-sm">
                <button class="faq-question w-full text-left flex justify-between items-center p-6">
                    <span class="text-lg font-semibold text-gray-800">How long does the visa application process take?</span>
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                </button>
                <div class="faq-answer p-6 pt-0">
                    <p class="text-gray-600">Processing times vary greatly depending on the embassy or consulate. Standard processing can take anywhere from a few days to several weeks. We recommend applying well in advance of your planned travel dates. Expedited services are available for some countries.</p>
                </div>
            </div>
            
            <!-- FAQ Item 3 -->
            <div class="faq-item bg-gray-50 rounded-lg shadow-sm">
                <button class="faq-question w-full text-left flex justify-between items-center p-6">
                    <span class="text-lg font-semibold text-gray-800">Can you guarantee that my visa will be approved?</span>
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                </button>
                <div class="faq-answer p-6 pt-0">
                    <p class="text-gray-600">While we ensure your application is accurate, complete, and submitted correctly to maximize your chances of success, the final decision rests with the respective government's immigration authorities. We cannot guarantee visa approval, but we have a high success rate due to our meticulous preparation.</p>
                </div>
            </div>
            
            <!-- FAQ Item 4 -->
            <div class="faq-item bg-gray-50 rounded-lg shadow-sm">
                <button class="faq-question w-full text-left flex justify-between items-center p-6">
                    <span class="text-lg font-semibold text-gray-800">What are your service fees?</span>
                    <i class="fas fa-chevron-down transform transition-transform"></i>
                </button>
                <div class="faq-answer p-6 pt-0">
                    <p class="text-gray-600">Our service fees cover application assistance, document verification, and submission support. The fee does not include the visa fee charged by the embassy, which must be paid separately. Our fees are transparent and listed on each visa service page.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load carousel config and initialize
    fetch('/static/js/carousel-config.json')
        .then(response => response.json())
        .then(config => {
            initializeCarousel(config);
        })
        .catch(error => {
            console.error('Error loading carousel config:', error);
            // Fallback to default config
            const defaultConfig = {
                countries: [
                    {
                        name: "Japan",
                        backgroundImage: "https://images.unsplash.com/photo-1508179499299-2643424fae56?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    },
                    {
                        name: "Singapore",
                        backgroundImage: "https://images.unsplash.com/photo-1657445003648-aa6ed5fc5d63?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    },
                    {
                        name: "South Korea",
                        backgroundImage: "https://images.unsplash.com/photo-1551685314-8167cf1cba72?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    },
                    {
                        name: "Thailand",
                        backgroundImage: "https://plus.unsplash.com/premium_photo-1707793862259-78c4112475d1?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    },
                    {
                        name: "Vietnam",
                        backgroundImage: "https://images.unsplash.com/photo-1560979724-f86caa17a2ed?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    }
                ]
            };
            initializeCarousel(defaultConfig);
        });
    
    // Load featured countries - This is now removed
    // loadFeaturedCountries();
});

function initializeCarousel(config) {
    const hero = document.querySelector('.hero-klook');
    const carousel = document.querySelector('.city-carousel');
    let currentIndex = 0;
    let autoSlideInterval;
    let isUserInteracting = false;

    // Create city items from config
    carousel.innerHTML = config.countries.map((country, index) => 
        `<div class="city-item ${index === 0 ? 'active' : ''}" data-city="${country.name}" data-bg="${country.backgroundImage}">${country.name}</div>`
    ).join('');

    const cityItems = document.querySelectorAll('.city-item');

    // Set initial background
    const initialBg = cityItems[currentIndex].getAttribute('data-bg');
    hero.style.backgroundImage = `url('${initialBg}')`;

    // --- Auto Carousel Functionality ---
    function startAutoSlide() {
        autoSlideInterval = setInterval(() => {
            if (!isUserInteracting) {
                const nextIndex = (currentIndex + 1) % cityItems.length;
                setActiveCity(nextIndex);
            }
        }, 3000); // 3 seconds
    }

    function stopAutoSlide() {
        if (autoSlideInterval) {
            clearInterval(autoSlideInterval);
        }
    }

    function resetAutoSlide() {
        stopAutoSlide();
        setTimeout(() => {
            if (!isUserInteracting) {
                startAutoSlide();
            }
        }, 2000); // Wait 2 seconds after user interaction before resuming auto-slide
    }

    // --- Live Search ---
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results-klook');
    let debounceTimer;

    searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        const query = this.value;

        if (query.length < 2) {
            searchResults.style.display = 'none';
            return;
        }

        searchResults.innerHTML = `
            <div class="search-result-item">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                <div>
                    <strong>Searching...</strong>
                    <p>Finding countries matching "${query}"</p>
                </div>
            </div>
        `;
        searchResults.style.display = 'block';

        debounceTimer = setTimeout(() => {
            fetch(`/api/countries/search?q=${query}&limit=20`)
                .then(response => response.json())
                .then(data => {
                    searchResults.innerHTML = '';
                    if (data.length > 0) {
                        data.slice(0, 4).forEach(country => {
                            const item = document.createElement('a');
                            item.href = `/countries/${country.id}`;
                            item.classList.add('search-result-item');
                            item.innerHTML = `
                                <div class="flag">${country.flag}</div>
                                <div>
                                    <strong>${country.name}</strong>
                                    <p>${country.summary.length > 80 ? country.summary.substring(0, 80) + '...' : country.summary}</p>
                                </div>
                            `;
                            searchResults.appendChild(item);
                        });
                        
                        if (data.length > 4) {
                            const seeAllItem = document.createElement('a');
                            seeAllItem.href = `/search?q=${encodeURIComponent(query)}`;
                            seeAllItem.classList.add('search-result-item', 'see-all-results');
                            seeAllItem.innerHTML = `
                                <div class="see-all-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div>
                                    <strong>See all results for "${query}"</strong>
                                    <p>View all ${data.length}+ countries matching your search</p>
                                </div>
                            `;
                            searchResults.appendChild(seeAllItem);
                        }
                        
                        searchResults.style.display = 'block';
                    } else {
                        const noResultsItem = document.createElement('div');
                        noResultsItem.classList.add('search-result-item', 'no-results');
                        noResultsItem.innerHTML = `
                            <div class="no-results-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div>
                                <strong>No countries found</strong>
                                <p>Try adjusting your search terms</p>
                            </div>
                        `;
                        searchResults.appendChild(noResultsItem);
                        searchResults.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Search error:', error);
                    searchResults.style.display = 'none';
                });
        }, 300);
    });

    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-box-klook')) {
            searchResults.style.display = 'none';
        }
    });

    // --- City click functionality ---
    cityItems.forEach((item, index) => {
        item.addEventListener('click', function() {
            isUserInteracting = true;
            setActiveCity(index);
            resetAutoSlide();
            setTimeout(() => {
                isUserInteracting = false;
            }, 1000);
        });
    });

    function setActiveCity(index) {
        cityItems[currentIndex].classList.remove('active');
        cityItems[currentIndex].classList.add('distant');

        currentIndex = index;
        const targetBg = cityItems[currentIndex].getAttribute('data-bg');
        hero.style.backgroundImage = `url('${targetBg}')`;

        cityItems.forEach((item, i) => {
            item.classList.remove('active', 'semi-active', 'distant');
            if (i === currentIndex) {
                item.classList.add('active');
            } else if (Math.abs(i - currentIndex) === 1 || 
                       (currentIndex === 0 && i === cityItems.length - 1) ||
                       (currentIndex === cityItems.length - 1 && i === 0)) {
                item.classList.add('semi-active');
            } else {
                item.classList.add('distant');
            }
        });
    }

    // Start auto-slide
    startAutoSlide();

    // Handle hover interactions
    carousel.addEventListener('mouseenter', () => {
        isUserInteracting = true;
        stopAutoSlide();
    });

    carousel.addEventListener('mouseleave', () => {
        isUserInteracting = false;
        resetAutoSlide();
    });
}

// FAQ Accordion
document.addEventListener('DOMContentLoaded', function() {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        const answer = item.querySelector('.faq-answer');
        const icon = question.querySelector('i');

        // Remove inline style from HTML to allow CSS transitions
        answer.style.display = '';

        question.addEventListener('click', () => {
            const isOpen = answer.classList.contains('open');

            // Close all other answers
            document.querySelectorAll('.faq-answer').forEach(ans => {
                if (ans !== answer) {
                    ans.classList.remove('open');
                    ans.previousElementSibling.querySelector('i').classList.remove('rotate-180');
                }
            });

            // Toggle current answer
            answer.classList.toggle('open', !isOpen);
            icon.classList.toggle('rotate-180', !isOpen);
        });
    });
});
</script>
{% endblock %}
